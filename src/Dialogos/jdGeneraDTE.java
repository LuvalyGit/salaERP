/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Dialogos;

import Conexion.ExeSql;
import PanelForm.pfGDCliente;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;

/**
 *
 * @author DavidAlcaman
 */
public class jdGeneraDTE extends javax.swing.JDialog {
    public String Rut;
    public String TipDocto;
    public String NroDocto;
    public String Fecha;
    
    
    
    
    
    public jdGeneraDTE(java.awt.Frame parent, boolean modal) {
        super(parent, modal);
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        btNo = new javax.swing.JButton();
        btSi = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);

        jLabel1.setText("¿Emitir documento electrónico?");

        btNo.setText("No");

        btSi.setText("Si");
        btSi.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btSiActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(88, 88, 88)
                        .addComponent(jLabel1)
                        .addGap(0, 96, Short.MAX_VALUE))
                    .addGroup(layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(btNo)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(btSi)))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel1)
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btNo)
                    .addComponent(btSi))
                .addContainerGap(23, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents
    private void ImprimeEncabezado(BufferedWriter buffer){
        try {
            switch(TipDocto){
                case "GDC": buffer.write("1~52\n"); break;
                case "FAC": buffer.write("1~33\n"); break;
                case "NCC": buffer.write("1~61\n"); break;
                case "NDB": buffer.write("1~56\n"); break;    
            }
            buffer.write("2~" + NroDocto +"\n");
            buffer.write("3~" + Fecha +"\n");
            buffer.write("4~\n");
            buffer.write("5~\n");
            buffer.write("6~\n");
            buffer.write("7~\n");
            buffer.write("8~\n");
        } catch (Exception e) {
            System.out.println("Error en Encabezado");
        }
        
    }
    private void ImprimeDatosEmisor(BufferedWriter buffer){
        try {
            buffer.write("9~76.231.391-k\n");
            buffer.write("10~EMPRESA COMERCIALIZADORA LUIS VALDES LYON SPA\n");
            buffer.write("11~COMERCIALIZACION DE ARTICULOS DE FERETERIA, CONSTRUCCION, OFICINA, ASEO.\n");
            buffer.write("12~\n");
            buffer.write("13~AVENIDA HUERFANOS 1871 MODULO 11\n");
            buffer.write("14~TEMUCO\n");
            buffer.write("15~TEMUCO\n");
            buffer.write("16~O\n");
            buffer.write("17~\n");
            buffer.write("18~\n");
        } catch (Exception e) {
            System.out.println("Error Datos de Emisor");
        }
    }
    private void ImprimeDatosReceptor(BufferedWriter buffer){
        ExeSql  Sql = new ExeSql();
        ResultSet Rs;
        String Query =  " select cc.rut,cl.nombre, co.direccion,co.giro,co.comuna,co.ciudad\n" +
                        " from ctactecli cc\n" +
                        " left join cliente cl\n" +
                        " on cc.rut=cl.rut\n" +
                        " left join clicontacto co\n" +
                        " on cc.rut=co.rut and cc.nrodocorigen=co.codigo_oc\n" +
                        " where cc.rut="+ Rut + "\n" +
                        " and cc.tipdocto='" + TipDocto + "'\n" +
                        " and cc.nrodocto=" + NroDocto;
        
        try{
            Rs = Sql.Select(Query);
            Rs.next();
            buffer.write("19~" + Rs.getString("Rut").trim() + "\n");
            buffer.write("20~" + Rs.getString("Nombre").trim() + "\n");
            buffer.write("21~" + Rs.getString("Giro").trim() + "\n");
            buffer.write("22~" + Rs.getString("Direccion").trim() + "\n");
            buffer.write("23~" + Rs.getString("Comuna").trim() + "\n");    
            buffer.write("24~\n");
            buffer.write("25~" + Rs.getString("Rut").trim() + "\n");
            buffer.write("26~\n");
        } catch (SQLException | IOException e) {
                System.out.println("Error Datos Receptor" + e.getMessage());
            } finally{
            Sql.Close();
        }

    }
    private void ImprimeDatosTransporte(BufferedWriter buffer){
        try {
            buffer.write("27~\n");
            buffer.write("28~\n");
            buffer.write("29~\n");
            buffer.write("30~\n");
            buffer.write("31~\n");
            buffer.write("32~\n");
            buffer.write("33~\n");
            buffer.write("34~\n");
        } catch (Exception e) {
            System.out.println("Error al escribir Transporte");
        }
    }
    private void ImprimeTotales(BufferedWriter buffer){
        ExeSql  Sql = new ExeSql();
        ResultSet Rs;
        String Query =  " select totalexento,totalafecto,totaliva,totaldocto\n" +
                        " from ctactecli c\n" +
                        " where c.rut="+ Rut + "\n" +
                        " and c.tipdocto='" + TipDocto + "'\n" +
                        " and c.nrodocto=" + NroDocto;
        
        try{
            Rs = Sql.Select(Query);
            Rs.next();
            buffer.write("35~" + Rs.getString("totalafecto")  + "\n");      //Neto
            buffer.write("36~" + Rs.getString("totalexento") + "\n");       //Exento
            buffer.write("37~19\n");                                          //Taza iva (ej: 19)
            buffer.write("38~" + Rs.getString("totaliva") + "\n");          //Total IVA
            buffer.write("39~" + Rs.getString("totaldocto") + "\n");        //Monto Total
            } catch (Exception e) {
                JOptionPane.showMessageDialog(null, e);
            }finally{
            Sql.Close();
        }
            
    }
    private void ImprimeDatosMoneda(BufferedWriter buffer){
        try {
            buffer.write("40~\n");
            buffer.write("41~\n");
            buffer.write("42~\n");
        } catch (Exception e) {
        }
                
    }
    private void ImprimeProductos(BufferedWriter buffer){
        ResultSet Rs;
        //Rs = Sql.Select("");
    }
    private void btSiActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btSiActionPerformed
       File archivo = new File("c:/ArchivoJava.txt");
       BufferedWriter buffer;
        try {
            buffer = new BufferedWriter(new FileWriter(archivo));
            ImprimeEncabezado(buffer);
            ImprimeDatosEmisor(buffer);
            ImprimeDatosReceptor(buffer);
            ImprimeDatosTransporte(buffer);
            ImprimeTotales(buffer);
            ImprimeDatosMoneda(buffer);
            
            buffer.close();
        } catch (IOException ex) {
            Logger.getLogger(pfGDCliente.class.getName()).log(Level.SEVERE, null, ex);
        }
      dispose();
    }//GEN-LAST:event_btSiActionPerformed

    /**
     * @param args the command line arguments
     */
    
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(jdGeneraDTE.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(jdGeneraDTE.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(jdGeneraDTE.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(jdGeneraDTE.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the dialog */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                jdGeneraDTE dialog = new jdGeneraDTE(new javax.swing.JFrame(), true);
                dialog.addWindowListener(new java.awt.event.WindowAdapter() {
                    @Override
                    public void windowClosing(java.awt.event.WindowEvent e) {
                        System.exit(0);
                    }
                });
                dialog.setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btNo;
    private javax.swing.JButton btSi;
    private javax.swing.JLabel jLabel1;
    // End of variables declaration//GEN-END:variables
}
