/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Dialogos;

//import com.sun.org.apache.xml.internal.utils.StringComparable;

import Conexion.ExeSql;
import java.awt.event.KeyEvent;
import java.sql.ResultSet;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JOptionPane;


/**
 *
 * @author DavidAlcaman
 */
public class jdAddDatosPersona extends javax.swing.JDialog {
    int Cargando=0;
    int editando=0;
    int idcontacto, rut, codigo_oc;
    int nuevocon=0;
    int edita_contacto =0;
    /**
     * Creates new form jdAddProveedorVendedor
     */
    public jdAddDatosPersona(java.awt.Frame parent, boolean modal) {
        super(parent, modal);
        initComponents();
        lbCargo.setVisible(false);
        cbCargo.setVisible(false);
        txNombre.requestFocus();
//        cbCargoId.setVisible(false);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        btAceptar = new javax.swing.JButton();
        btCancelar = new javax.swing.JButton();
        txNombre = new javax.swing.JTextField();
        txFono = new javax.swing.JTextField();
        txCorreo = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        txCelular = new javax.swing.JTextField();
        lbCargo = new javax.swing.JLabel();
        cbCargo = new javax.swing.JComboBox();
        cbCargoId = new javax.swing.JComboBox();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);

        jLabel1.setText("Nombre");

        jLabel2.setText("Fono");

        jLabel3.setText("Correo");

        btAceptar.setText("Aceptar");
        btAceptar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btAceptarActionPerformed(evt);
            }
        });

        btCancelar.setText("Cancelar");
        btCancelar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btCancelarActionPerformed(evt);
            }
        });

        txNombre.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txNombreKeyPressed(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txNombreKeyTyped(evt);
            }
        });

        txFono.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txFonoKeyPressed(evt);
            }
        });

        txCorreo.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txCorreoKeyPressed(evt);
            }
        });

        jLabel4.setText("Fono 2");

        txCelular.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txCelularKeyPressed(evt);
            }
        });

        lbCargo.setText("Cargo");

        cbCargo.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        cbCargo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbCargoActionPerformed(evt);
            }
        });

        cbCargoId.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        cbCargoId.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbCargoIdActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap(50, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(lbCargo)
                    .addComponent(jLabel4)
                    .addComponent(jLabel1)
                    .addComponent(jLabel2)
                    .addComponent(jLabel3))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                        .addComponent(txNombre, javax.swing.GroupLayout.DEFAULT_SIZE, 263, Short.MAX_VALUE)
                        .addComponent(txFono, javax.swing.GroupLayout.PREFERRED_SIZE, 139, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(txCelular, javax.swing.GroupLayout.PREFERRED_SIZE, 139, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(txCorreo))
                    .addComponent(cbCargo, javax.swing.GroupLayout.PREFERRED_SIZE, 154, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(btCancelar)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(cbCargoId, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btAceptar))
                .addGap(21, 21, 21))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.CENTER)
                    .addComponent(jLabel1)
                    .addComponent(txNombre, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.CENTER)
                    .addComponent(txFono, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel2))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.CENTER)
                    .addComponent(jLabel4)
                    .addComponent(txCelular, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.CENTER)
                    .addComponent(jLabel3)
                    .addComponent(txCorreo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lbCargo)
                    .addComponent(cbCargo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(cbCargoId, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 12, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(btCancelar, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(btAceptar, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents
    
    public void EditarContactoPrv(String Rut, String Id){
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        editando = 3;
        lbCargo.setVisible(true);
        cbCargo.setVisible(true);

        try {
            Rs = Sql.Select("select *\n" +
                            "from prv_contacto\n" +
                            "where rut="+ Rut +"\n" +
                            "and id=" + Id);
            if(Sql.GetRowCount()>0){
                Rs.next();
                try {
                    txNombre.setText(Rs.getString("nombre").trim());
                } catch (Exception e) {
                }
                try {
                    txFono.setText(Rs.getString("fono1").trim());
                } catch (Exception e) {
                }
                try {
                    txCelular.setText(Rs.getString("fono2").trim());
                } catch (Exception e) {
                }
                try {
                    txCorreo.setText(Rs.getString("email").trim());
                } catch (Exception e) {
                }
                try {
                    cbCargoId.setSelectedItem(Rs.getInt("tipo"));
                } catch (Exception e) {
                }
            }
            idcontacto = Integer.valueOf(Id);
                  
        } catch (Exception e) {
            System.out.println(e.getMessage());
        } finally{
            Sql.Close();
        }
    }
    public void EditarContacto(String Rut, String Id){
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        editando = 1;
        lbCargo.setVisible(true);
        cbCargo.setVisible(true);

        try {
            Rs = Sql.Select("select *\n" +
                            "from clicontactopersonas\n" +
                            "where rut="+ Rut +"\n" +
                            "and id=" + Id);
            if(Sql.GetRowCount()>0){
                Rs.next();
                try {
                    txNombre.setText(Rs.getString("nombre").trim());
                } catch (Exception e) {
                }
                try {
                    txFono.setText(Rs.getString("fono").trim());
                } catch (Exception e) {
                }
                try {
                    txCelular.setText(Rs.getString("celular").trim());
                } catch (Exception e) {
                }
                try {
                    txCorreo.setText(Rs.getString("email").trim());
                } catch (Exception e) {
                }
                try {
                    cbCargoId.setSelectedItem(Rs.getInt("tipo"));
                } catch (Exception e) {
                }
            }
            idcontacto = Integer.valueOf(Id);
                  
        } catch (Exception e) {
            System.out.println(e.getMessage());
        } finally{
            Sql.Close();
        }
    }
    public void ConTipo(String tipo){
        Cargando=1;
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        
        cbCargo.removeAllItems();
        cbCargoId.removeAllItems();
        
        try {
            lbCargo.setVisible(true);
            cbCargo.setVisible(true);
            if (tipo.equals("proveedor"))
                    {
                    Rs = Sql.Select("select codigo,nombre\n" +
                                    "from par_general\n" +
                                    "where tipo='TIPCONTACTOPRV' order by codigo asc");
                    }
            else
                {
                Rs = Sql.Select("select codigo,nombre\n" +
                                "from par_general\n" +
                                "where tipo='TIPCONTACTOCLI' order by codigo asc");
                }
            while(Rs.next()){
                cbCargo.addItem(Rs.getString("nombre").trim());
                cbCargoId.addItem(Rs.getInt("codigo"));
            }
        } catch (Exception e) {
            System.out.println(e.getMessage());
        } finally{
            Sql.Close();
            Cargando=0;
        }
        
        
    }
    
    public void Editar(int edicion, String nombre, String fono, String celular, String mail,int id, String cargo){
        editando = edicion;
        idcontacto =id;
        txNombre.setText(nombre);
        txFono.setText(fono);
        txCorreo.setText(mail);
        txCelular.setText(celular);
        cbCargo.setSelectedItem(cargo);
       }
    
    public void Nuevo (int nuevo, int Xrut, int Xcodigo_oc)
    {
       nuevocon  = nuevo;
       rut       = Xrut;
       codigo_oc = Xcodigo_oc;
       
    }
    
    
    private void btCancelarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btCancelarActionPerformed
        txNombre.setText("");
        txFono.setText("");
        txCorreo.setText("");
        txCelular.setText("");
        dispose();
    }//GEN-LAST:event_btCancelarActionPerformed

    private void btAceptarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btAceptarActionPerformed
        ExeSql Sql = new ExeSql();
        if (editando==1){
            
            try{
                Sql.ExeSql("UPDATE clicontactopersonas \n" +
                          " SET nombre='"+txNombre.getText().trim()+"', fono='"+txFono.getText().trim()+"' \n" +
                          ", celular='"+txCelular.getText().trim()+"', email='"+txCorreo.getText().trim()+"' \n"+
                          ", id_cargo="+cbCargoId.getSelectedItem()+" where id="+idcontacto);
                Sql.Commit();
        
            }
            catch (Exception e)
                {
                Sql.Rollback();
                System.out.println("Error: "+e);
                }
            finally
                {
                Sql.Close();
                editando=0;
                    
                }
            
           
            }
        
            if (editando==3){  //Opcion que edita los datos
            
                try{
                
                    Sql.ExeSql("UPDATE prv_contacto \n" +
                              "SET nombre='"+txNombre.getText().trim()+"', fono1='"+txFono.getText().trim()+"',\n" +
                              "fono2='"+txCelular.getText().trim()+"', email='"+txCorreo.getText().trim()+"',\n"+
                              "tipo="+cbCargoId.getSelectedItem()+" where id="+idcontacto);
                    Sql.Commit();
        
                }catch (Exception e){
                
                    Sql.Rollback();
                
                    System.out.println("Error: "+e);
                
                }finally{
                
                    Sql.Close();
                    editando=0;
                    JOptionPane.showMessageDialog(rootPane, "Modificado con éxito, verá el cambio al seleccionar el contacto de nuevo en la orden de compra.");
                }
            
           
            }
        
            if (nuevocon==1) {
            
                try{
                
                    Sql.ExeSql("INSERT into clicontactopersonas \n" +
                    "(rut, codigo_oc, nombre, fono, celular, email, id_cargo) VALUES \n"+
                    "("+rut+", "+
                        codigo_oc+", '"+
                        txNombre.getText().trim()+"', '"+
                        txFono.getText().trim()+"', '"+
                        txCelular.getText().trim()+"', '"+
                        txCorreo.getText().trim()+"', "+
                        cbCargoId.getSelectedItem()+")");
                
                    Sql.Commit();
        
                }catch (Exception e){
                
                    Sql.Rollback();
                    System.out.println("Error: "+e);
                
                }finally{
                    
                    Sql.Close();
                    nuevocon=0;
                }
            
            }
        
            dispose();
    }//GEN-LAST:event_btAceptarActionPerformed

    private void txNombreKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txNombreKeyPressed
        if(evt.getKeyCode() == KeyEvent.VK_ENTER)
            txFono.requestFocus();
    }//GEN-LAST:event_txNombreKeyPressed

    private void txFonoKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txFonoKeyPressed
    if(evt.getKeyCode() == KeyEvent.VK_ENTER)
            txCelular.requestFocus();
    }//GEN-LAST:event_txFonoKeyPressed

    private void txCelularKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txCelularKeyPressed
        if(evt.getKeyCode() == KeyEvent.VK_ENTER)
            txCorreo.requestFocus();
    }//GEN-LAST:event_txCelularKeyPressed

    private void txCorreoKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txCorreoKeyPressed
        if(evt.getKeyCode() == KeyEvent.VK_ENTER)
            btAceptar.doClick();
    }//GEN-LAST:event_txCorreoKeyPressed

    private void txNombreKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txNombreKeyTyped
        if (Character.isLowerCase(evt.getKeyChar()))
            evt.setKeyChar(Character.toUpperCase(evt.getKeyChar()));        // TODO add your handling code here:
    }//GEN-LAST:event_txNombreKeyTyped

    private void cbCargoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbCargoActionPerformed
        if(Cargando==0)
            cbCargoId.setSelectedIndex(cbCargo.getSelectedIndex());
    }//GEN-LAST:event_cbCargoActionPerformed

    private void cbCargoIdActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbCargoIdActionPerformed
        if(Cargando==0)
            cbCargo.setSelectedIndex(cbCargoId.getSelectedIndex());
    }//GEN-LAST:event_cbCargoIdActionPerformed
    public Object[] GetFila(){
        if(!txNombre.getText().isEmpty())
            if(cbCargo.isVisible())
                return new Object[] {txNombre.getText(),txFono.getText(),txCelular.getText(),txCorreo.getText(),cbCargo.getSelectedItem().toString().trim(),cbCargoId.getSelectedItem().toString().trim()};
            else
                return new Object[] {txNombre.getText(),txFono.getText(),txCelular.getText(),txCorreo.getText(),"0"};
        else    
            return null;

        
    }
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(jdAddDatosPersona.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(jdAddDatosPersona.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(jdAddDatosPersona.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(jdAddDatosPersona.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>
        //</editor-fold>

        /* Create and display the dialog */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                jdAddDatosPersona dialog = new jdAddDatosPersona(new javax.swing.JFrame(), true);
                dialog.addWindowListener(new java.awt.event.WindowAdapter() {
                    @Override
                    public void windowClosing(java.awt.event.WindowEvent e) {
                        System.exit(0);
                    }
                });
                dialog.setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btAceptar;
    private javax.swing.JButton btCancelar;
    private javax.swing.JComboBox cbCargo;
    private javax.swing.JComboBox cbCargoId;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel lbCargo;
    private javax.swing.JTextField txCelular;
    private javax.swing.JTextField txCorreo;
    private javax.swing.JTextField txFono;
    private javax.swing.JTextField txNombre;
    // End of variables declaration//GEN-END:variables
}
