/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package PanelForm;

import Conexion.ExeSql;
import Formularios.fmMain;
import java.awt.Toolkit;
import java.awt.datatransfer.Clipboard;
import java.awt.datatransfer.DataFlavor;
import java.io.File;
import java.io.FileInputStream;
import java.sql.ResultSet;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.Iterator;
import java.util.List;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import javax.swing.SwingConstants;
import javax.swing.filechooser.FileNameExtensionFilter;
import javax.swing.table.DefaultTableCellRenderer;
import javax.swing.table.DefaultTableModel;
import org.apache.poi.xssf.usermodel.XSSFCell;
import org.apache.poi.xssf.usermodel.XSSFRow;
import org.apache.poi.xssf.usermodel.XSSFSheet;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;

/**
 *
 * @author David Alcaman
 */
public class pfBco_CartolasTC extends javax.swing.JPanel {

    boolean Cargando;
    DefaultTableCellRenderer rightRenderer = new DefaultTableCellRenderer();
    /**
     * Creates new form pfBco_Cartolas
     */
    public pfBco_CartolasTC() {
        initComponents();
        Cargando=true;
        CargaBancos();
        Cargando=false;
        rightRenderer.setHorizontalAlignment(SwingConstants.RIGHT);
        Grilla.getColumnModel().getColumn(5).setCellRenderer(rightRenderer);
        Grilla.getColumnModel().getColumn(6).setCellRenderer(rightRenderer);
        Grilla.getColumnModel().getColumn(7).setCellRenderer(rightRenderer);
        Grilla.getColumnModel().getColumn(8).setCellRenderer(rightRenderer);
        btCancelar.setVisible(false);
        btGuardar.setVisible(false);
        cbBancoId.setVisible(false);
        cbCuentaId.setVisible(false);
        cbAgno.setSelectedIndex(-1);
        cbMes.setSelectedIndex(-1);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        buttonGroup1 = new javax.swing.ButtonGroup();
        jPanel1 = new javax.swing.JPanel();
        cbBancoId = new javax.swing.JComboBox();
        jLabel1 = new javax.swing.JLabel();
        cbBanco = new javax.swing.JComboBox();
        jLabel5 = new javax.swing.JLabel();
        cbCuentaId = new javax.swing.JComboBox();
        cbCuenta = new javax.swing.JComboBox();
        cbMes = new javax.swing.JComboBox<String>();
        jLabel2 = new javax.swing.JLabel();
        cbAgno = new javax.swing.JComboBox<String>();
        jScrollPane1 = new javax.swing.JScrollPane();
        Grilla = new javax.swing.JTable();
        jPanel3 = new javax.swing.JPanel();
        btCancelar = new javax.swing.JButton();
        btGuardar = new javax.swing.JButton();
        btNuevaCartola = new javax.swing.JButton();
        jPanel2 = new javax.swing.JPanel();

        jPanel1.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        cbBancoId.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));

        jLabel1.setText("Banco");

        cbBanco.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        cbBanco.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbBancoActionPerformed(evt);
            }
        });

        jLabel5.setText("Cuenta");

        cbCuenta.setModel(new javax.swing.DefaultComboBoxModel(new String[] { " ", " " }));
        cbCuenta.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbCuentaActionPerformed(evt);
            }
        });

        cbMes.setMaximumRowCount(12);
        cbMes.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre" }));
        cbMes.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbMesActionPerformed(evt);
            }
        });

        jLabel2.setText("Fecha");

        cbAgno.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "2015", "2016", "2017", "2018", "2019", "2020", "2021" }));
        cbAgno.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbAgnoActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(cbAgno, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(cbMes, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addContainerGap()
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jLabel1)
                                    .addComponent(cbBanco, javax.swing.GroupLayout.PREFERRED_SIZE, 216, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jLabel5)
                                    .addComponent(cbCuenta, javax.swing.GroupLayout.PREFERRED_SIZE, 216, javax.swing.GroupLayout.PREFERRED_SIZE)))
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addContainerGap()
                                .addComponent(jLabel2))
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addGap(10, 10, 10)
                                .addComponent(cbBancoId, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(18, 18, 18)
                                .addComponent(cbCuentaId, javax.swing.GroupLayout.PREFERRED_SIZE, 18, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addGap(0, 0, Short.MAX_VALUE)))
                .addContainerGap())
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(cbBanco, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel5)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(cbCuenta, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel2)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(cbAgno, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(cbMes, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 120, Short.MAX_VALUE)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(cbBancoId, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(cbCuentaId, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(20, 20, 20))
        );

        Grilla.setFont(new java.awt.Font("Arial", 0, 10)); // NOI18N
        Grilla.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null, null, null, null, null}
            },
            new String [] {
                "Fecha", "Ciudad", "Numero", "Detalle", "Cuota", "Monto Compra", "$ Cargo", "$ Abono", "Saldo", "Asoc.", "Fec Fac", "nro Cuota", "Total Cuotas", "MontoPago"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Boolean.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class
            };
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false, false, false, false, false, false, false, false
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        Grilla.setAutoscrolls(false);
        jScrollPane1.setViewportView(Grilla);
        if (Grilla.getColumnModel().getColumnCount() > 0) {
            Grilla.getColumnModel().getColumn(0).setMinWidth(80);
            Grilla.getColumnModel().getColumn(0).setPreferredWidth(80);
            Grilla.getColumnModel().getColumn(0).setMaxWidth(80);
            Grilla.getColumnModel().getColumn(1).setMinWidth(120);
            Grilla.getColumnModel().getColumn(1).setPreferredWidth(120);
            Grilla.getColumnModel().getColumn(1).setMaxWidth(150);
            Grilla.getColumnModel().getColumn(2).setMinWidth(100);
            Grilla.getColumnModel().getColumn(2).setPreferredWidth(100);
            Grilla.getColumnModel().getColumn(2).setMaxWidth(100);
            Grilla.getColumnModel().getColumn(3).setMinWidth(230);
            Grilla.getColumnModel().getColumn(3).setPreferredWidth(230);
            Grilla.getColumnModel().getColumn(4).setMinWidth(60);
            Grilla.getColumnModel().getColumn(4).setPreferredWidth(60);
            Grilla.getColumnModel().getColumn(4).setMaxWidth(60);
            Grilla.getColumnModel().getColumn(6).setMinWidth(85);
            Grilla.getColumnModel().getColumn(6).setPreferredWidth(85);
            Grilla.getColumnModel().getColumn(6).setMaxWidth(85);
            Grilla.getColumnModel().getColumn(7).setMinWidth(85);
            Grilla.getColumnModel().getColumn(7).setPreferredWidth(85);
            Grilla.getColumnModel().getColumn(7).setMaxWidth(85);
            Grilla.getColumnModel().getColumn(8).setMinWidth(85);
            Grilla.getColumnModel().getColumn(8).setPreferredWidth(85);
            Grilla.getColumnModel().getColumn(8).setMaxWidth(85);
            Grilla.getColumnModel().getColumn(9).setMinWidth(40);
            Grilla.getColumnModel().getColumn(9).setPreferredWidth(45);
            Grilla.getColumnModel().getColumn(9).setMaxWidth(60);
            Grilla.getColumnModel().getColumn(10).setMinWidth(0);
            Grilla.getColumnModel().getColumn(10).setPreferredWidth(0);
            Grilla.getColumnModel().getColumn(10).setMaxWidth(0);
            Grilla.getColumnModel().getColumn(11).setMinWidth(0);
            Grilla.getColumnModel().getColumn(11).setPreferredWidth(0);
            Grilla.getColumnModel().getColumn(11).setMaxWidth(0);
            Grilla.getColumnModel().getColumn(12).setMinWidth(0);
            Grilla.getColumnModel().getColumn(12).setPreferredWidth(0);
            Grilla.getColumnModel().getColumn(12).setMaxWidth(0);
            Grilla.getColumnModel().getColumn(13).setMinWidth(0);
            Grilla.getColumnModel().getColumn(13).setPreferredWidth(0);
            Grilla.getColumnModel().getColumn(13).setMaxWidth(0);
        }

        jPanel3.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), "Ingresar Cartola"));

        btCancelar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/Cancel16.png"))); // NOI18N
        btCancelar.setText("Cancelar");
        btCancelar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btCancelarActionPerformed(evt);
            }
        });

        btGuardar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/ok_16.png"))); // NOI18N
        btGuardar.setText("Guardar");
        btGuardar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btGuardarActionPerformed(evt);
            }
        });

        btNuevaCartola.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/New.png"))); // NOI18N
        btNuevaCartola.setText("Nueva Cartola");
        btNuevaCartola.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btNuevaCartolaActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(btCancelar)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(btGuardar)
                .addContainerGap())
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel3Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(btNuevaCartola)
                .addGap(52, 52, 52))
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(btNuevaCartola)
                .addGap(0, 0, 0)
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btCancelar)
                    .addComponent(btGuardar))
                .addContainerGap())
        );

        jPanel2.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 0, Short.MAX_VALUE)
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 22, Short.MAX_VALUE)
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 1143, Short.MAX_VALUE))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
        );
    }// </editor-fold>//GEN-END:initComponents
    
    private void CargaBancos(){
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        
        cbBanco.removeAllItems();
        cbBancoId.removeAllItems();
        
        try {
            Rs = Sql.Select("select id,nombre\n" +
                            "from bco_bancos where id>0\n" +
                            "order by id");
            while(Rs.next()){
                cbBancoId.addItem(Rs.getInt("id"));
                cbBanco.addItem(Rs.getString("nombre"));
            }
            cbBanco.setSelectedIndex(-1);
            cbBancoId.setSelectedIndex(-1);
        } catch (Exception e) {
            fmMain.Mensaje("Error");
        } finally{
            Sql.Close();
        }
    }
    private void CargaCuentas(String Banco){
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        
        cbCuenta.removeAllItems();
        cbCuentaId.removeAllItems();
        
        try {
            Rs = Sql.Select("select id,cuenta\n" +
                            "from bco_cuentas \n" +
                            "where banco=" + Banco + "\n" +
                            "and tipo=2");
            while(Rs.next()){
                cbCuentaId.addItem(Rs.getInt("id"));
                cbCuenta.addItem(Rs.getString("cuenta").trim());
            }
            cbCuenta.setSelectedIndex(-1);
            cbCuentaId.setSelectedIndex(-1);
        } catch (Exception e) {
            fmMain.Mensaje("Error: " + e.getMessage());
        } finally{
            Sql.Close();
        }
    }
    private void cbBancoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbBancoActionPerformed
        if(!Cargando){
            cbBancoId.setSelectedIndex(cbBanco.getSelectedIndex());
            CargaCuentas(cbBancoId.getSelectedItem().toString());
        }
        
    }//GEN-LAST:event_cbBancoActionPerformed

    private void cbCuentaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbCuentaActionPerformed
            cbCuentaId.setSelectedIndex(cbCuenta.getSelectedIndex());
            if(cbCuentaId.getSelectedIndex()!=-1){
                btNuevaCartola.setEnabled(true);
            }
                
            else{
                btNuevaCartola.setEnabled(false);
            }
            if(cbCuenta.getSelectedIndex()>-1 && cbAgno.getSelectedIndex()>-1 && cbMes.getSelectedIndex()>-1){
                CargaCartola(cbCuentaId.getSelectedItem().toString().trim());
            }
    }//GEN-LAST:event_cbCuentaActionPerformed
    
    private void btCancelarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btCancelarActionPerformed
        if(fmMain.OkCancel("¿Descartar los datos copiados ?")== JOptionPane.OK_OPTION){
            LimpiaGrilla((DefaultTableModel) Grilla.getModel());
            btGuardar.setVisible(false);
            btCancelar.setVisible(false);
            btNuevaCartola.setVisible(true);
            cbBanco.setEnabled(true);
            cbCuenta.setEnabled(true);
        }
    }//GEN-LAST:event_btCancelarActionPerformed
    
    private void LimpiaGrilla(DefaultTableModel Model){
        while(Model.getRowCount()>0)
              Model.removeRow(0);
    }
    
    private void btGuardarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btGuardarActionPerformed
       ExeSql Sql = new ExeSql();
       ResultSet Rs; 
        //Validaciones
        try {
            Rs = Sql.Select("select count(*) as existe\n" +
                            "from bco_cartola_tc\n" +
                            "where cuenta="+ cbCuentaId.getSelectedItem().toString().trim() + "\n" +
                            "and fechafac='" + Grilla.getValueAt(0, 10).toString().trim()+"'" );
            Rs.next();
            if(Rs.getInt("existe")>0){
                fmMain.Mensaje("Una o más fechas ya estan registradas en el Sistema. No se puede Guardar");
                Sql.Close();
                return;
            }
                
        } catch (Exception e) {
            System.out.println(e.getMessage());
        }
       
        
        
        
       
       
       if(fmMain.OkCancel("¿Desea guardar los datos?")== JOptionPane.OK_OPTION){
           try {
            for (int i = 0; i < Grilla.getRowCount(); i++) {
                System.out.println("insert into bco_cartola_tc\n" +
                       "(cuenta,fechafac,fechacom,ciudad,codigo,descripcion,ncuota,tcuotas,montocompra,montopago,cargo,abono,saldo) values\n" +
                       "(" + 
                        cbCuentaId.getSelectedItem().toString().trim() + ",'" + 
                        Grilla.getValueAt(i,10).toString().trim() + "','" +
                        Grilla.getValueAt(i,0).toString().trim() + "','" +
                        Grilla.getValueAt(i,1).toString().trim() + "','" +
                        Grilla.getValueAt(i,2).toString().trim() + "','" +
                        Grilla.getValueAt(i,3).toString().trim() + "'," +
                        fmMain.SetGuardarEntero(Grilla.getValueAt(i,11).toString().trim()) + "," +
                        fmMain.SetGuardarEntero(Grilla.getValueAt(i,12).toString().trim()) + "," +
                        fmMain.SetGuardarEntero(Grilla.getValueAt(i,5).toString().trim())+ "," +
                        fmMain.SetGuardarEntero(Grilla.getValueAt(i,13).toString().trim())+ "," +
                        fmMain.SetGuardarEntero(Grilla.getValueAt(i,6).toString().trim()) + "," +
                        fmMain.SetGuardarEntero(Grilla.getValueAt(i,7).toString().trim()) + "," +
                        fmMain.SetGuardarEntero(Grilla.getValueAt(i,8).toString().trim()) + 
                        ")");
                
                Sql.ExeSql("insert into bco_cartola_tc\n" +
                       "(cuenta,fechafac,fechacom,ciudad,codigo,descripcion,ncuota,tcuotas,montocompra,montopago,cargo,abono,saldo) values\n" +
                       "(" + 
                        cbCuentaId.getSelectedItem().toString().trim() + ",'" + 
                        Grilla.getValueAt(i,10).toString().trim() + "','" +
                        Grilla.getValueAt(i,0).toString().trim() + "','" +
                        Grilla.getValueAt(i,1).toString().trim() + "','" +
                        Grilla.getValueAt(i,2).toString().trim() + "','" +
                        Grilla.getValueAt(i,3).toString().trim() + "'," +
                        fmMain.SetGuardarEntero(Grilla.getValueAt(i,11).toString().trim()) + "," +
                        fmMain.SetGuardarEntero(Grilla.getValueAt(i,12).toString().trim()) + "," +
                        fmMain.SetGuardarEntero(Grilla.getValueAt(i,5).toString().trim())+ "," +
                        fmMain.SetGuardarEntero(Grilla.getValueAt(i,13).toString().trim())+ "," +
                        fmMain.SetGuardarEntero(Grilla.getValueAt(i,6).toString().trim()) + "," +
                        fmMain.SetGuardarEntero(Grilla.getValueAt(i,7).toString().trim()) + "," +
                        fmMain.SetGuardarEntero(Grilla.getValueAt(i,8).toString().trim()) + 
                        ")");
            }
            Sql.Commit();
            fmMain.Mensaje("Datos Guardados");
            btGuardar.setVisible(false);
            btCancelar.setVisible(false);
            btNuevaCartola.setVisible(true);
            LimpiaGrilla((DefaultTableModel) Grilla.getModel());
            cbBanco.setEnabled(true);
            cbCuenta.setEnabled(true);
            } catch (Exception e) {
                fmMain.Mensaje("Error al Guardar: " + e.getMessage());
            } finally {
                Sql.Close();
            }
       }
       
        
    }//GEN-LAST:event_btGuardarActionPerformed

    private void CargaCartola(String Cuenta){
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        DefaultTableModel Model = (DefaultTableModel) Grilla.getModel();
        LimpiaGrilla(Model);
        SimpleDateFormat sdf = new SimpleDateFormat("dd-MM-yyyy");
        
        try {
            Rs = Sql.Select("select fechacom,ciudad,codigo,descripcion,ncuota,tcuotas,montocompra,cargo,abono,saldo\n" +
                            "from bco_cartola_tc\n" +
                            "where cuenta="+ Cuenta +"\n" +
                            "and extract(year from fechafac)=" + cbAgno.getSelectedItem().toString().trim() + "\n" +
                            "and extract(month from fechafac)=" + String.valueOf(cbMes.getSelectedIndex() + 1));
            
            while(Rs.next()){
                Model.addRow(new Object[]{
                                Rs.getString("fechacom").trim(),
                                Rs.getString("ciudad").trim(),
                                Rs.getString("codigo").trim(),
                                Rs.getString("descripcion").trim(),
                                Rs.getString("ncuota") + " de " + Rs.getString("tcuotas"),
                                Rs.getDouble("montocompra"),
                                Rs.getDouble("Cargo"),
                                Rs.getDouble("abono"),
                                Rs.getDouble("saldo")
                });
            }
            
        } catch (Exception e) {
            System.out.println(e.getMessage());
        }
    }
    private void btNuevaCartolaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btNuevaCartolaActionPerformed
               //Validaciones
        if(cbCuentaId.getSelectedIndex()==-1){
            fmMain.Mensaje("Debe seleccionar una Cuenta");
            return;
        }
        
        if(fmMain.OkCancel("¿Desea cargar una nueva Cartola del " + cbBanco.getSelectedItem().toString().trim() + " a la Tarjeta de Crédito " + cbCuenta.getSelectedItem().toString().trim()+" ?")== JOptionPane.OK_OPTION){
        String LINE_BREAK = "\n"; 
        String CELL_BREAK = "\t"; 
        Clipboard CLIPBOARD = Toolkit.getDefaultToolkit().getSystemClipboard(); 
        String pasteString = ""; 
        
        
        String Ciudad ="";
        String FechaFac="";
        String FechaCom="";
        String Numero = "";
        String Detalle="";
        String NCuota="";
        String TCuotas="";
        String MontoCompra="";
        String MontoPago="";
        String Cargo="";
        String Abono="";
        String Saldo="";
        
        DefaultTableModel Model = (DefaultTableModel) Grilla.getModel();
        
        while(Model.getRowCount()>0)
              Model.removeRow(0);
        
                try { 
                        pasteString = (String)(CLIPBOARD.getContents(this).getTransferData(DataFlavor.stringFlavor)); 
                } catch (Exception e) { 
                        JOptionPane.showMessageDialog(null, "Formato Invalido", "Formato Invalido", JOptionPane.ERROR_MESSAGE);
                        return; 
                } 
                try {
                String[] lines = pasteString.split(LINE_BREAK); 
                for (int i=0 ; i<lines.length; i++) { 
                        
                        String[] cells = lines[i].split(CELL_BREAK); 
                                        FechaFac    = cells[0];
                                        Ciudad      = cells[1];
                                        FechaCom    = cells[2];
                                        Numero      = cells[3];
                                        Detalle     = cells[4];
                                        NCuota      = cells[5];
                                        TCuotas     = cells[6];
                                        MontoCompra = cells[7];
                                        MontoPago   = cells[8];
                                        Cargo       = cells[9];
                                        Abono       = cells[10];
                                        Saldo       = cells[11];
                                    
                                    MontoCompra = fmMain.SetGuardar(MontoCompra);
                                    MontoPago   = fmMain.SetGuardar(MontoPago);
                                    Cargo       = fmMain.SetGuardar(Cargo);
                                    Abono       = fmMain.SetGuardar(Abono);
                                    Saldo       = fmMain.SetGuardar(Saldo);
                                    
                            if(Detalle.length()>60)
                                Detalle = Detalle.substring(0, 59);
                            if(Cargo.isEmpty())
                                Cargo = "$ 0";
                            if(Abono.isEmpty())
                                Abono = "$ 0";
                        Model.addRow(new Object[]{FechaCom,Ciudad,Numero,Detalle,NCuota + " de " + TCuotas,MontoCompra,Cargo,Abono,Saldo,false,FechaFac,NCuota,TCuotas,MontoPago});
                }   
            } catch (Exception e) {
                    System.out.println(e.getMessage());
            }
        btGuardar.setVisible(true);
        btCancelar.setVisible(true);
        btNuevaCartola.setVisible(false);
        cbBanco.setEnabled(false);
        cbCuenta.setEnabled(false);        
        }
    }//GEN-LAST:event_btNuevaCartolaActionPerformed

    private void cbMesActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbMesActionPerformed
        if(cbCuenta.getSelectedIndex()>-1 && cbAgno.getSelectedIndex()>-1 && cbMes.getSelectedIndex()>-1){
            CargaCartola(cbCuentaId.getSelectedItem().toString().trim());
        }
    }//GEN-LAST:event_cbMesActionPerformed

    private void cbAgnoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbAgnoActionPerformed
       if(cbCuenta.getSelectedIndex()>-1 && cbAgno.getSelectedIndex()>-1 && cbMes.getSelectedIndex()>-1){
            CargaCartola(cbCuentaId.getSelectedItem().toString().trim());
        } // TODO add your handling code here:
    }//GEN-LAST:event_cbAgnoActionPerformed

       
//    private String Funcion(int Suma, int Indice, int Monto ){
//        String Retorno="";
//        for (int i = Indice; i < Tabla.getRowCount(); i++) {
//            if((Integer) Tabla.getValueAt(i, 0) > Monto)
//                break;
//            
//            else if( (Integer) Tabla.getValueAt(i, 0)  + Suma == Monto){
//                return Tabla.getValueAt(i, 0).toString().trim();
//            }
//            else if((Integer) Tabla.getValueAt(i, 0) < Monto){
//                Retorno=Funcion(Suma + (Integer) Tabla.getValueAt(i, 0),i+1,Monto);
//                if(!Retorno.isEmpty())
//                    return Tabla.getValueAt(i, 0).toString().trim() + Retorno;
//            }
//            
//                
//        }
//        return "";
//    }
        
    private String GetNuevasFechas(){
        String Fechas="";
        String UltimaFecha="";
                
        for (int i = 0; i < Grilla.getRowCount() ; i++) {
            if(!UltimaFecha.equals(Grilla.getValueAt(i, 0).toString().trim())){
                UltimaFecha = Grilla.getValueAt(i, 0).toString().trim();
                Fechas = Fechas + "'" + UltimaFecha + "',";
            }
        }
        Fechas = Fechas.substring(0, Fechas.length()-1);
        
        return Fechas;
        
    }
    

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTable Grilla;
    private javax.swing.JButton btCancelar;
    private javax.swing.JButton btGuardar;
    private javax.swing.JButton btNuevaCartola;
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.JComboBox<String> cbAgno;
    private javax.swing.JComboBox cbBanco;
    private javax.swing.JComboBox cbBancoId;
    private javax.swing.JComboBox cbCuenta;
    private javax.swing.JComboBox cbCuentaId;
    private javax.swing.JComboBox<String> cbMes;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JScrollPane jScrollPane1;
    // End of variables declaration//GEN-END:variables
}
